<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Explorer!</title>
    <!-- Add marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Poppins:wght@400;700;900&family=Rubik:wght@400;700;900&display=swap');
        
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Rubik', sans-serif;
            color: #2C3E50;
            min-height: 100vh;
            background-image: url('assets/90s-sprinkles.svg');
            background-repeat: repeat;
            background-size: 100px 100px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #FFFFFF;
            border: 6px solid #2C3E50;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 10px 10px 0 #2C3E50;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 100px);
        }
        
        /* Navigation tab styles */
        .nav-tabs {
            position: absolute;
            left: -50px;
            top: 50px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .nav-tab {
            width: 40px;
            height: 80px;
            background-color: #FFE66D;
            border: 4px solid #2C3E50;
            border-right: none;
            border-radius: 10px 0 0 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            font-size: 0.9em;
            transition: all 0.2s ease;
            text-decoration: none;
            color: #2C3E50;
        }

        .nav-tab:hover {
            background-color: #4ECDC4;
            /* Remove the transform that causes detachment */
            /* transform: translateX(-5px); */
            box-shadow: -3px 3px 0 #2C3E50;
        }

        .nav-tab.active {
            background-color: #FFFFFF;
            /* Adjust transform to ensure it stays connected */
            transform: translateX(1px);
            z-index: 1;
            box-shadow: none;
        }
        
        /* Adjust container for mobile */
        @media (max-width: 600px) {
            .nav-tabs {
                position: static;
                flex-direction: row;
                margin-bottom: 20px;
                left: 0;
                top: 0;
            }
            
            .nav-tab {
                width: auto;
                height: 40px;
                padding: 0 20px;
                writing-mode: horizontal-tb;
                border: 4px solid #2C3E50;
                border-radius: 10px 10px 0 0;
                border-bottom: none;
            }
            
            .nav-tab.active {
                transform: translateY(1px);
                box-shadow: none;
            }
            
            .nav-tab:hover {
                /* Adjust for mobile horizontal tabs */
                /* transform: translateY(-5px); */
                box-shadow: 0 -3px 0 #2C3E50;
            }
        }

        /* New side buttons styles */
        .side-buttons {
            position: absolute;
            right: -90px;
            top: 50px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .side-button {
            width: 50px;
            height: 50px;
            background-color: #4ECDC4;
            border: 4px solid #2C3E50;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            font-size: 1.5em;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #2C3E50;
            box-shadow: 3px 3px 0 #2C3E50;
        }

        .side-button:hover {
            background-color: #FFE66D;
            transform: rotate(15deg);
        }
        
        .title {
            font-family: 'Rubik', sans-serif;
            font-size: 3em;
            font-weight: 900;
            color: #2C3E50;
            text-align: center;
            margin-bottom: 30px;
            text-transform: uppercase;
            position: relative;
        }
        
        .title::after {
            content: '?!';
            position: absolute;
            color: #FF6B6B;
            font-size: 0.8em;
            transform: rotate(15deg);
            margin-left: 10px;
        }
        
        .question-container {
            position: relative;
            margin-bottom: 30px;
        }
        
        .question-input {
            width: 100%;
            padding: 15px;
            font-size: 1.3em;
            border: 4px solid #2C3E50;
            border-radius: 10px;
            background-color: #FFE66D;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
        }
        
        .question-input:focus {
            outline: none;
            background-color: #FFFFFF;
            box-shadow: 5px 5px 0 #2C3E50;
        }
        
        .ask-button {
            background-color: #4ECDC4;
            color: #2C3E50;
            border: 4px solid #2C3E50;
            padding: 15px 30px;
            font-size: 1.5em;
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            margin-top: 20px;
            display: block;
            width: 100%;
        }
        
        .ask-button:hover {
            transform: translate(-3px, -3px);
            box-shadow: 6px 6px 0 #2C3E50;
        }
        
        .ask-button:active {
            transform: translate(0, 0);
            box-shadow: 0 0 0 #2C3E50;
        }
        
        .ask-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .answer-box {
            background-color: #F7FFF7;
            border: 4px solid #2C3E50;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            min-height: 200px;
            position: relative;
            display: none;
        }
        
        .answer-box.visible {
            display: block;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
        }
        
        .loading-dots {
            display: inline-block;
            font-size: 2em;
            color: #4ECDC4;
        }
        
        .loading-dots span {
            animation: bounce 1.4s infinite ease-in-out both;
            margin: 0 5px;
            display: inline-block;
        }
        
        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }
        
        .answer-content {
            font-size: 1.2em;
            line-height: 1.6;
            font-family: 'Nunito', sans-serif;
        }
        
        /* Markdown styling */
        .answer-content h1, .answer-content h2, .answer-content h3 {
            color: #2C3E50;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            font-family: 'Rubik', sans-serif;
        }
        
        .answer-content h1 { font-size: 1.8em; }
        .answer-content h2 { font-size: 1.5em; }
        .answer-content h3 { font-size: 1.3em; }
        
        .answer-content p {
            margin-bottom: 1em;
        }
        
        .answer-content ul, .answer-content ol {
            margin-left: 1.5em;
            margin-bottom: 1em;
        }
        
        .answer-content li {
            margin-bottom: 0.5em;
        }
        
        .answer-content code {
            background-color: #f0f0f0;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
        }
        
        .answer-content pre {
            background-color: #f0f0f0;
            padding: 1em;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        .answer-content blockquote {
            border-left: 4px solid #4ECDC4;
            margin-left: 0;
            padding-left: 1em;
            color: #666;
        }
        
        .answer-content strong {
            font-weight: 700;
            color: #2C3E50;
        }
        
        .answer-content em {
            font-style: italic;
        }
        
        .answer-content a {
            color: #4ECDC4;
            text-decoration: none;
            border-bottom: 2px solid #4ECDC4;
        }
        
        .answer-content a:hover {
            color: #FF6B6B;
            border-bottom-color: #FF6B6B;
        }
        
        /* Enhanced suggestions area */
        .suggestions-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            margin-top: 30px;
        }
        
        .suggestions {
            margin-bottom: 20px;
        }
        
        .suggestions-title {
            font-family: 'Rubik', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .topic-button {
            background-color: #FFE66D;
            border: 3px solid #2C3E50;
            border-radius: 12px;
            padding: 15px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .topic-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 0 #2C3E50;
            background-color: #4ECDC4;
        }
        
        .topic-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .topic-name {
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 1em;
            text-align: center;
        }
        
        /* Recent questions section */
        .recent-questions {
            margin-top: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .recent-questions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .recent-questions-title {
            font-family: 'Rubik', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
            color: #2C3E50;
        }
        
        .clear-history {
            background-color: #FF6B6B;
            color: white;
            border: 2px solid #2C3E50;
            border-radius: 8px;
            padding: 5px 10px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .clear-history:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 0 #2C3E50;
        }
        
        .question-history-list {
            background-color: #F7FFF7;
            border: 3px solid #2C3E50;
            border-radius: 12px;
            padding: 10px;
            overflow-y: auto;
            max-height: 200px;
            flex: 1;
        }
        
        .question-history-item {
            padding: 10px;
            border-bottom: 2px solid #E0E0E0;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
        }
        
        .question-history-item:last-child {
            border-bottom: none;
        }
        
        .question-history-item:hover {
            background-color: #FFE66D;
            border-radius: 8px;
        }
        
        .question-text {
            font-family: 'Nunito', sans-serif;
            flex: 1;
        }
        
        .question-time {
            color: #666;
            font-size: 0.8em;
            white-space: nowrap;
            margin-left: 10px;
        }
        
        .no-questions {
            text-align: center;
            padding: 20px;
            color: #666;
            font-style: italic;
        }
        
        /* Decorative elements */
        .star {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #FFE66D;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .star-1 { top: -10px; left: 20px; transform: rotate(15deg); }
        .star-2 { top: -10px; right: 40px; transform: rotate(-20deg); }
        .star-3 { bottom: -10px; left: 50%; transform: rotate(30deg); }
        
        .error-message {
            color: #FF6B6B;
            text-align: center;
            font-weight: bold;
        }
        
        /* Scrollbar styling */
        .question-history-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .question-history-list::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
        }
        
        .question-history-list::-webkit-scrollbar-thumb {
            background: #4ECDC4;
            border-radius: 4px;
        }
        
        .question-history-list::-webkit-scrollbar-thumb:hover {
            background: #FF6B6B;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-tabs">
            <a href="index.html" class="nav-tab active">ASK</a>
            <a href="chat.html" class="nav-tab">CHAT</a>
        </div>

        <div class="side-buttons">
            <a href="info.html" class="side-button" title="Information">i</a>
            <a href="settings.html" class="side-button" title="Settings">‚öô</a>
        </div>
        
        <div class="star star-1"></div>
        <div class="star star-2"></div>
        <div class="star star-3"></div>
        
        <h1 class="title">Question Explorer</h1>
        
        <div class="question-container">
            <input type="text" class="question-input" id="questionInput" placeholder="Ask me anything! (ex: How do airplanes fly?)">
            <button class="ask-button" id="askButton">Ask Away!</button>
        </div>
        
        <div class="answer-box" id="answerBox">
            <div class="loading" id="loading">
                <div class="loading-dots">
                    <span>‚óè</span>
                    <span>‚óè</span>
                    <span>‚óè</span>
                </div>
                <p>Thinking...</p>
            </div>
            <div class="answer-content" id="answerContent"></div>
        </div>
        
        <div class="suggestions-area">
            <div class="suggestions">
                <div class="suggestions-title">Choose a Topic to Explore:</div>
                <div class="topics-grid">
                    <div class="topic-button" data-topic="space">
                        <div class="topic-icon">üöÄ</div>
                        <div class="topic-name">Space</div>
                    </div>
                    <div class="topic-button" data-topic="cats">
                        <div class="topic-icon">üê±</div>
                        <div class="topic-name">Cats</div>
                    </div>
                    <div class="topic-button" data-topic="math">
                        <div class="topic-icon">üî¢</div>
                        <div class="topic-name">Math</div>
                    </div>
                    <div class="topic-button" data-topic="weird">
                        <div class="topic-icon">ü§Ø</div>
                        <div class="topic-name">Weird Facts</div>
                    </div>
                    <div class="topic-button" data-topic="weather">
                        <div class="topic-icon">‚õàÔ∏è</div>
                        <div class="topic-name">Weather</div>
                    </div>
                    <div class="topic-button" data-topic="history">
                        <div class="topic-icon">üèõÔ∏è</div>
                        <div class="topic-name">Cool History</div>
                    </div>
                    <div class="topic-button" data-topic="computers">
                        <div class="topic-icon">üíª</div>
                        <div class="topic-name">Computers</div>
                    </div>
                    <div class="topic-button" data-topic="animals">
                        <div class="topic-icon">ü¶ä</div>
                        <div class="topic-name">Animals</div>
                    </div>
                </div>
            </div>
            
            <div class="recent-questions">
                <div class="recent-questions-header">
                    <div class="recent-questions-title">Your Recent Questions:</div>
                    <button class="clear-history" id="clearHistoryBtn">Clear History</button>
                </div>
                <div class="question-history-list" id="questionHistoryList">
                    <div class="no-questions">No questions yet. Ask something!</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questionInput = document.getElementById('questionInput');
        const askButton = document.getElementById('askButton');
        const answerBox = document.getElementById('answerBox');
        const loading = document.getElementById('loading');
        const answerContent = document.getElementById('answerContent');
        const topicButtons = document.querySelectorAll('.topic-button');
        const questionHistoryList = document.getElementById('questionHistoryList');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');

        const SYSTEM_PROMPT = `You are answering questions that an 8-12 year old, but very precocious child is asking you. You will be acting as their 'assistant'! Speak in a casual way but don't talk down to them, they're very smart! Use simple language, fun analogies, and examples that would be relatable to a Gen Alpha child. Make complex ideas easy to understand. They may sometimes ask you out of context questions or just random stuff, in those cases play along :) The child is particularly interested in complex math (giant numbers like Graham's number, tetration, stuff like that), technology (coding, computers in general, vintage tech and operating systems), and also has a fondness for snakes, the color red, and cats. Use markdown formatting to make your response more readable - use headers, bold, italics, lists, etc. when appropriate.`;

        // Question collections by topic
        const TOPIC_QUESTIONS = {
            space: [
                "How big is the universe?",
                "Why is space black?",
                "How many planets are in our solar system?",
                "What are black holes?",
                "How do stars form?",
                "Can humans live on Mars?",
                "What is the Milky Way?",
                "How old is the universe?",
                "What is the International Space Station?",
                "Are there other galaxies?"
            ],
            cats: [
                "Why do cats purr?",
                "How do cats always land on their feet?",
                "Why do cats knead with their paws?",
                "How far can cats jump?",
                "Why do cats have whiskers?",
                "How many hours do cats sleep each day?",
                "Can cats see in complete darkness?",
                "Why do cats' eyes glow in the dark?",
                "How fast can cats run?",
                "Do cats sweat?"
            ],
            math: [
                "What is Graham's number?",
                "Can you explain infinity to me?",
                "What is tetration?",
                "What's the biggest number with a name?",
                "What is the Mandelbrot set?",
                "How do imaginary numbers work?",
                "What is the Fibonacci sequence?",
                "Can you explain prime numbers?",
                "What is a googolplex?",
                "How do fractals work?"
            ],
            weird: [
                "Why do we have fingerprints?",
                "Can trees communicate with each other?",
                "Why do some people have different colored eyes?",
                "Are there animals that can live forever?",
                "Why does time seem to go faster as you get older?",
                "How do optical illusions trick our brains?",
                "Do other animals dream like humans do?",
                "Why can't we tickle ourselves?",
                "Why do we get brain freeze when eating cold things?",
                "Can plants feel pain?"
            ],
            weather: [
                "How do tornadoes form?",
                "Why does lightning make thunder?",
                "How do hurricanes get their names?",
                "Why does it rain?",
                "What makes a rainbow appear?",
                "How do snowflakes form?",
                "What causes fog?",
                "Why is the sky blue?",
                "What is the coldest place on Earth?",
                "How do meteorologists predict the weather?"
            ],
            history: [
                "Who invented video games?",
                "What was the weirdest fashion trend in history?",
                "When was the first computer invented?",
                "Who were the Vikings?",
                "What was the most surprising ancient technology?",
                "Were there female pirates?",
                "What did ancient Egyptian kids play with?",
                "Who invented pizza?",
                "What was school like 100 years ago?",
                "What's the oldest city in the world?"
            ],
            computers: [
                "How do computers think?",
                "How does the internet work?",
                "What is coding?",
                "How do video games work?",
                "What is artificial intelligence?",
                "How do computers store information?",
                "Who invented the first computer?",
                "What is a computer virus?",
                "How fast can computers calculate?",
                "How does a computer chip work?"
            ],
            animals: [
                "How do animals communicate?",
                "Why do cats purr?",
                "How smart are dolphins?",
                "Why do snakes shed their skin?",
                "How do birds know where to migrate?",
                "Why do dogs wag their tails?",
                "How do chameleons change color?",
                "Do animals have feelings?",
                "How do bees make honey?",
                "Why do some animals glow in the dark?"
            ]
        };
        
        // Initialize question history from localStorage
        let questionHistory = [];
        const MAX_HISTORY = 10;

        // Get settings from localStorage
        function getSettings() {
            const settings = localStorage.getItem('questionExplorerSettings');
            if (settings) {
                return JSON.parse(settings);
            }
            // Default settings if none found
            return {
                provider: 'gemini',
                model: 'gemini-2.0-flash',
                apiKey: '',
                temperature: 0.7,
                maxTokens: 1024,
                topP: 0.8,
                topK: 40,
                saveHistory: true
            };
            }
        
        function loadQuestionHistory() {
            const saved = localStorage.getItem('questionHistory');
            if (saved) {
                questionHistory = JSON.parse(saved);
                renderQuestionHistory();
            }
        }
        
        function saveQuestionHistory() {
            localStorage.setItem('questionHistory', JSON.stringify(questionHistory));
        }
        
        function formatTimeAgo(timestamp) {
            const now = new Date();
            const questionTime = new Date(timestamp);
            const diffInSeconds = Math.floor((now - questionTime) / 1000);
            
            if (diffInSeconds < 60) {
                return 'just now';
            } else if (diffInSeconds < 3600) {
                const minutes = Math.floor(diffInSeconds / 60);
                return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            } else if (diffInSeconds < 86400) {
                const hours = Math.floor(diffInSeconds / 3600);
                return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            } else {
                const days = Math.floor(diffInSeconds / 86400);
                return `${days} day${days > 1 ? 's' : ''} ago`;
            }
        }
        
        function renderQuestionHistory() {
            if (questionHistory.length === 0) {
                questionHistoryList.innerHTML = '<div class="no-questions">No questions yet. Ask something!</div>';
                return;
            }
            
            questionHistoryList.innerHTML = '';
            questionHistory.forEach((item, index) => {
                const questionItem = document.createElement('div');
                questionItem.className = 'question-history-item';
                questionItem.innerHTML = `
                    <div class="question-text">${item.question}</div>
                    <div class="question-time">${formatTimeAgo(item.timestamp)}</div>
                `;
                
                questionItem.addEventListener('click', () => {
                    questionInput.value = item.question;
                    if (item.answer) {
                        // If we already have the answer, just display it
                        showSavedAnswer(item.answer);
                    } else {
                        // Otherwise ask the question again
                        askQuestion();
                    }
                });
                
                questionHistoryList.appendChild(questionItem);
            });
        }
        
        function updateTimeDisplays() {
            const timeElements = questionHistoryList.querySelectorAll('.question-time');
            questionHistory.forEach((item, index) => {
                if (timeElements[index]) {
                    timeElements[index].textContent = formatTimeAgo(item.timestamp);
                }
            });
        }
        
        // Update time displays every minute
        setInterval(updateTimeDisplays, 60000);
        
        function showSavedAnswer(answer) {
            answerBox.classList.add('visible');
            loading.style.display = 'none';
            answerContent.style.display = 'block';
            answerContent.innerHTML = marked.parse(answer);
        }
        
        // Function to get a random question from a topic
        function getRandomQuestion(topic) {
            const questions = TOPIC_QUESTIONS[topic];
            const randomIndex = Math.floor(Math.random() * questions.length);
            return questions[randomIndex];
        }

        async function getAnswer(question, settings) {
            const API_ENDPOINT = '/.netlify/functions/ask';
            
            try {
                console.log('Using provider:', settings.provider);
                console.log('Using model:', settings.model);
                
                const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    question: question,
                    systemPrompt: SYSTEM_PROMPT,
                    provider: settings.provider,
                    model: settings.model,
                    apiKey: settings.apiKey,
                    temperature: settings.temperature,
                    maxTokens: settings.maxTokens,
                    topP: settings.topP,
                    topK: settings.topK
                })
                });

                if (!response.ok) {
                const errorData = await response.json();
                console.error('API Error:', errorData);
                throw new Error(errorData.error || `Network response was not ok: ${response.status}`);
                }

                const data = await response.json();
                return data.answer;
            } catch (error) {
                console.error('Error details:', error);
                throw error;
            }
            }

        // Add a visual indicator for the active provider
        function addProviderIndicator() {
            const settings = getSettings();
            
            // Check if indicator already exists
            if (document.getElementById('providerIndicator')) return;
            
            // Create provider indicator
            const indicator = document.createElement('div');
            indicator.id = 'providerIndicator';
            indicator.className = 'provider-indicator';
            
            // Add provider logo or name
            let providerName;
            switch (settings.provider) {
                case 'gemini': providerName = 'Gemini'; break;
                case 'openai': providerName = 'OpenAI'; break;
                case 'anthropic': providerName = 'Claude'; break;
                case 'groq': providerName = 'Groq'; break;
                case 'deepseek': providerName = 'DeepSeek'; break;
                default: providerName = 'AI';
            }
            
            indicator.textContent = `Powered by: ${providerName}`;
            indicator.style.cssText = `
                position: fixed;
                bottom: 10px;
                left: 10px;
                background-color: #4ECDC4;
                color: #2C3E50;
                padding: 5px 10px;
                border-radius: 20px;
                font-family: 'Nunito', sans-serif;
                font-size: 0.8em;
                font-weight: 700;
                border: 2px solid #2C3E50;
                z-index: 1000;
            `;
            
            document.body.appendChild(indicator);
        }

        function updateProviderIndicator() {
            const settings = getSettings();
            
            // Remove existing indicator if it exists
            const existingIndicator = document.getElementById('providerIndicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            
            // Create provider indicator
            const indicator = document.createElement('div');
            indicator.id = 'providerIndicator';
            indicator.className = 'provider-indicator';
            
            // Add provider logo or name
            let providerName;
            switch (settings.provider) {
                case 'gemini': providerName = 'Gemini'; break;
                case 'openai': providerName = 'OpenAI'; break;
                case 'anthropic': providerName = 'Claude'; break;
                case 'groq': providerName = 'Groq'; break;
                case 'deepseek': providerName = 'DeepSeek'; break;
                default: providerName = 'AI';
            }
            
            indicator.textContent = `Powered by: ${providerName}`;
            indicator.style.cssText = `
                position: fixed;
                bottom: 10px;
                left: 10px;
                background-color: #4ECDC4;
                color: #2C3E50;
                padding: 5px 10px;
                border-radius: 20px;
                font-family: 'Nunito', sans-serif;
                font-size: 0.8em;
                font-weight: 700;
                border: 2px solid #2C3E50;
                z-index: 1000;
            `;
            
            document.body.appendChild(indicator);
            }

        // Add favorite button to answer box
        function addFavoriteButton() {
            // Check if button already exists
            if (document.getElementById('favoriteButton')) return;
            
            // Create favorite button
            const favoriteButton = document.createElement('button');
            favoriteButton.id = 'favoriteButton';
            favoriteButton.className = 'favorite-button';
            favoriteButton.innerHTML = '‚òÜ Add to Favorites';
            favoriteButton.style.cssText = `
                position: absolute;
                top: 10px;
                right: 10px;
                background-color: #FFE66D;
                color: #2C3E50;
                border: 2px solid #2C3E50;
                border-radius: 8px;
                padding: 5px 12px;
                font-family: 'Rubik', sans-serif;
                font-weight: 700;
                font-size: 0.9em;
                cursor: pointer;
                transition: all 0.2s ease;
            `;
            
            favoriteButton.addEventListener('mouseover', () => {
                favoriteButton.style.transform = 'translateY(-2px)';
                favoriteButton.style.boxShadow = '2px 2px 0 #2C3E50';
            });
            
            favoriteButton.addEventListener('mouseout', () => {
                favoriteButton.style.transform = 'translateY(0)';
                favoriteButton.style.boxShadow = 'none';
            });
            
            // Add the button to the answer box
            const answerBox = document.getElementById('answerBox');
            answerBox.appendChild(favoriteButton);
            
            // Handle favorite toggle
            favoriteButton.addEventListener('click', toggleFavorite);
        }

        // Toggle favorite status of current question/answer
        function toggleFavorite() {
            const favoriteButton = document.getElementById('favoriteButton');
            const question = document.getElementById('questionInput').value;
            const answer = document.getElementById('answerContent').innerHTML;
            
            // Get current favorites from localStorage
            let favorites = [];
            const saved = localStorage.getItem('favorites');
            if (saved) {
                favorites = JSON.parse(saved);
            }
            
            // Check if this question is already favorited
            const existingIndex = favorites.findIndex(f => f.question === question);
            
            if (existingIndex > -1) {
                // Remove from favorites
                favorites.splice(existingIndex, 1);
                favoriteButton.innerHTML = '‚òÜ Add to Favorites';
                favoriteButton.style.backgroundColor = '#FFE66D';
            } else {
                // Add to favorites
                const newFavorite = {
                    id: generateId(),
                    question: question,
                    answer: answer,
                    timestamp: new Date().toISOString(),
                    tags: [],
                    notes: ''
                };
                
                favorites.unshift(newFavorite);
                favoriteButton.innerHTML = '‚òÖ Favorited!';
                favoriteButton.style.backgroundColor = '#FF6B6B';
                favoriteButton.style.color = 'white';
                
                // Show success message
                showSuccessMessage();
            }
            
            // Save to localStorage
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        // Generate unique ID for favorites
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substring(2, 9);
        }

        // Show success message when added to favorites
        function showSuccessMessage() {
            // Check if message already exists
            if (document.getElementById('favoriteMessage')) return;
            
            const message = document.createElement('div');
            message.id = 'favoriteMessage';
            message.innerHTML = 'üéâ Added to favorites!';
            message.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background-color: #4ECDC4;
                color: white;
                padding: 10px 20px;
                border-radius: 10px;
                border: 3px solid #2C3E50;
                font-family: 'Rubik', sans-serif;
                font-weight: 700;
                box-shadow: 5px 5px 0 rgba(0, 0, 0, 0.1);
                z-index: 1000;
                transition: all 0.3s ease;
                animation: slideIn 0.3s forwards;
            `;
            
            document.body.appendChild(message);
            
            // Define the animation
            const style = document.createElement('style');
            style.innerHTML = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Remove after 3 seconds
            setTimeout(() => {
                message.style.animation = 'slideOut 0.3s forwards';
                setTimeout(() => {
                    document.body.removeChild(message);
                }, 300);
            }, 3000);
        }

        async function askQuestion() {
            const question = questionInput.value.trim();
            if (!question) return;

            askButton.disabled = true;
            
            answerBox.classList.add('visible');
            loading.style.display = 'block';
            answerContent.style.display = 'none';

            try {
                // Get user settings
                const settings = getSettings();
                
                // Update the provider indicator before making the request
                updateProviderIndicator();
                
                const answer = await getAnswer(question, settings);
                console.log('Received answer:', answer);
                
                // Only save history if enabled in settings
                if (settings.saveHistory) {
                // Add to question history
                const newQuestion = {
                    question: question,
                    answer: answer,
                    timestamp: new Date().toISOString()
                };
                
                // Add to the beginning of the array
                questionHistory.unshift(newQuestion);
                
                // Maintain maximum history size
                if (questionHistory.length > MAX_HISTORY) {
                    questionHistory = questionHistory.slice(0, MAX_HISTORY);
                }
                
                saveQuestionHistory();
                renderQuestionHistory();
                }
                
                // Display answer
                loading.style.display = 'none';
                answerContent.style.display = 'block';
                
                // Convert markdown to HTML
                answerContent.innerHTML = marked.parse(answer);
                
                // Add favorite button to answer
                addFavoriteButton();
                
                // Update favorite button state
                updateFavoriteButtonState(question);
            } catch (error) {
                console.error('Error in askQuestion:', error);
                loading.style.display = 'none';
                answerContent.style.display = 'block';
                answerContent.innerHTML = `<div class="error-message">Error: ${error.message || 'Something went wrong. Please try again.'}</div>`;
            } finally {
                askButton.disabled = false;
            }
            }

        // Update favorite button state
        function updateFavoriteButtonState(question) {
            const favoriteButton = document.getElementById('favoriteButton');
            if (!favoriteButton) return;
            
            // Get current favorites from localStorage
            let favorites = [];
            const saved = localStorage.getItem('favorites');
            if (saved) {
                favorites = JSON.parse(saved);
            }
            
            // Check if this question is already favorited
            const existingIndex = favorites.findIndex(f => f.question === question);
            
            if (existingIndex > -1) {
                favoriteButton.innerHTML = '‚òÖ Favorited!';
                favoriteButton.style.backgroundColor = '#FF6B6B';
                favoriteButton.style.color = 'white';
            } else {
                favoriteButton.innerHTML = '‚òÜ Add to Favorites';
                favoriteButton.style.backgroundColor = '#FFE66D';
                favoriteButton.style.color = '#2C3E50';
            }
        }

        // Check for favorite parameter in URL
        function checkForFavoriteParam() {
            const urlParams = new URLSearchParams(window.location.search);
            const favoriteId = urlParams.get('favorite');
            
            if (favoriteId) {
                // Get favorites from localStorage
                const saved = localStorage.getItem('favorites');
                if (saved) {
                    const favorites = JSON.parse(saved);
                    const favorite = favorites.find(f => f.id === favoriteId);
                    
                    if (favorite) {
                        // Set question and display answer
                        questionInput.value = favorite.question;
                        
                        // Show answer immediately
                        answerBox.classList.add('visible');
                        loading.style.display = 'none';
                        answerContent.style.display = 'block';
                        answerContent.innerHTML = favorite.answer;
                        
                        // Add favorite button and update its state
                        addFavoriteButton();
                        updateFavoriteButtonState(favorite.question);
                    }
                }
            }
        }

        // Add navigation tab for favorites
        function addFavoritesTab() {
            const navTabs = document.querySelector('.nav-tabs');
            const favTab = document.createElement('a');
            favTab.href = 'favorites.html';
            favTab.className = 'nav-tab';
            favTab.textContent = '‚òÖ';
            navTabs.appendChild(favTab);
        }

        // Initialize favorites functionality
        window.addEventListener('DOMContentLoaded', () => {
            addFavoritesTab();
            checkForFavoriteParam();
        });

        // Update the page's visual state when it becomes visible
        document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
            // Update provider indicator when returning to the page
            updateProviderIndicator();
        }
        });

        // Call this on page load
        document.addEventListener('DOMContentLoaded', function() {
        loadQuestionHistory();
        updateProviderIndicator();
        });

        askButton.addEventListener('click', askQuestion);
        
        questionInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !askButton.disabled) {
                askQuestion();
            }
        });

        topicButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Get the topic from the data-topic attribute
                const topic = button.dataset.topic;
                
                // Get a random question for this topic
                const randomQuestion = getRandomQuestion(topic);
                
                // Set the question in the input field
                questionInput.value = randomQuestion;
                
                // Trigger the ask function
                askQuestion();
            });
        });
        
        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear your question history?')) {
                questionHistory = [];
                saveQuestionHistory();
                renderQuestionHistory();
            }
        });
        
        // Initialize on page load
        loadQuestionHistory();
    </script>
</body>
</html>