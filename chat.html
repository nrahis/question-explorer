<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Explorer!</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Poppins:wght@400;700;900&family=Rubik:wght@400;700;900&family=Space+Mono:wght@400;700&family=VT323&family=Press+Start+2P&display=swap');
        
        body {
            margin: 0;
            padding: 20px;
            background-color: #FF6B6B;
            font-family: 'Rubik', sans-serif;
            color: #2C3E50;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, #FFE66D 15px, transparent 16px),
                radial-gradient(circle at 90% 80%, #4ECDC4 15px, transparent 16px),
                radial-gradient(circle at 40% 60%, #FF6B6B 10px, transparent 11px);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #FFFFFF;
            border: 6px solid #2C3E50;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 10px 10px 0 #2C3E50;
            position: relative;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 100px);
        }
        
        /* Navigation tab styles */
        .nav-tabs {
            position: absolute;
            left: -50px;
            top: 50px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .nav-tab {
            width: 40px;
            height: 80px;
            background-color: #FFE66D;
            border: 4px solid #2C3E50;
            border-right: none;
            border-radius: 10px 0 0 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            font-size: 0.9em;
            transition: all 0.2s ease;
            text-decoration: none;
            color: #2C3E50;
        }
        
        .nav-tab:hover {
            background-color: #4ECDC4;
            transform: translateX(-5px);
        }
        
        .nav-tab.active {
            background-color: #FFFFFF;
            transform: translateX(4px);
        }
        
        /* Settings bar */
        .settings-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .font-selector, .color-selector {
            background-color: #FFE66D;
            border: 3px solid #2C3E50;
            border-radius: 8px;
            padding: 5px 10px;
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .clear-button {
            background-color: #FF6B6B;
            color: white;
            border: 3px solid #2C3E50;
            border-radius: 8px;
            padding: 5px 15px;
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s ease;
        }
        
        .clear-button:hover {
            transform: translateY(-2px);
            box-shadow: 3px 3px 0 #2C3E50;
        }
        
        /* Title */
        .title {
            font-family: 'Rubik', sans-serif;
            font-size: 2.5em;
            font-weight: 900;
            color: #2C3E50;
            text-align: center;
            margin-bottom: 10px;
            text-transform: uppercase;
            position: relative;
        }
        
        .persona-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            overflow-x: auto;
            padding: 10px 0;
        }
        
        .persona-button {
            background-color: #FFE66D;
            border: 3px solid #2C3E50;
            border-radius: 10px;
            padding: 10px 15px;
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .persona-button:hover {
            background-color: #4ECDC4;
            transform: translateY(-2px);
        }
        
        .persona-button.active {
            background-color: #FF6B6B;
            color: white;
            box-shadow: 4px 4px 0 #2C3E50;
        }
        
        .chat-window {
            flex: 1;
            background-color: #F7FFF7;
            border: 4px solid #2C3E50;
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s ease;
        }
        
        .message {
            max-width: 70%;
            padding: 10px 15px;
            margin: 8px 0;
            border: 3px solid #2C3E50;
            border-radius: 15px;
            position: relative;
            font-size: 1.1em;
            transition: all 0.2s ease;
        }
        
        .message.user {
            background-color: #4ECDC4;
            align-self: flex-end;
            margin-left: auto;
        }
        
        .message.bot {
            background-color: #FFE66D;
            align-self: flex-start;
        }
        
        /* Markdown styling for bot messages */
        .message.bot h1, .message.bot h2, .message.bot h3 {
            color: #2C3E50;
            margin-top: 1em;
            margin-bottom: 0.5em;
            font-family: 'Rubik', sans-serif;
        }
        
        .message.bot h1 { font-size: 1.5em; }
        .message.bot h2 { font-size: 1.3em; }
        .message.bot h3 { font-size: 1.1em; }
        
        .message.bot p {
            margin-bottom: 0.8em;
        }
        
        .message.bot ul, .message.bot ol {
            margin-left: 1.5em;
            margin-bottom: 0.8em;
        }
        
        .message.bot code {
            background-color: rgba(0,0,0,0.1);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Space Mono', monospace;
            font-size: 0.9em;
        }
        
        .message.bot pre {
            background-color: rgba(0,0,0,0.1);
            padding: 0.8em;
            border-radius: 5px;
            overflow-x: auto;
            margin: 0.5em 0;
        }
        
        .message.bot blockquote {
            border-left: 4px solid #4ECDC4;
            margin-left: 0;
            padding-left: 1em;
            color: #666;
        }
        
        .message.bot strong {
            font-weight: 700;
        }
        
        .message.bot em {
            font-style: italic;
        }
        
        .message.bot a {
            color: #2C3E50;
            text-decoration: underline;
        }
        
        .input-area {
            display: flex;
            gap: 10px;
            position: relative;
        }
        
        .chat-input {
            flex: 1;
            padding: 15px;
            font-size: 1.2em;
            border: 4px solid #2C3E50;
            border-radius: 10px;
            background-color: #FFFFFF;
            font-family: inherit;
        }
        
        .chat-input:focus {
            outline: none;
            box-shadow: 4px 4px 0 #2C3E50;
        }
        
        .emoji-button {
            background-color: #FFE66D;
            color: #2C3E50;
            border: 4px solid #2C3E50;
            padding: 15px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .emoji-button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 #2C3E50;
        }
        
        .emoji-picker {
            position: absolute;
            bottom: 70px;
            right: 0;
            background-color: white;
            border: 4px solid #2C3E50;
            border-radius: 10px;
            padding: 10px;
            display: none;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            box-shadow: 5px 5px 0 #2C3E50;
            z-index: 1000;
        }
        
        .emoji-picker.visible {
            display: grid;
        }
        
        .emoji-option {
            font-size: 1.5em;
            cursor: pointer;
            padding: 5px;
            border-radius: 5px;
            transition: all 0.2s ease;
        }
        
        .emoji-option:hover {
            background-color: #FFE66D;
        }
        
        .send-button {
            background-color: #4ECDC4;
            color: #2C3E50;
            border: 4px solid #2C3E50;
            padding: 15px 25px;
            font-size: 1.2em;
            font-family: 'Rubik', sans-serif;
            font-weight: 700;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .send-button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0 #2C3E50;
        }
        
        .send-button:active {
            transform: translate(0, 0);
            box-shadow: 0 0 0 #2C3E50;
        }
        
        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .typing-indicator {
            display: none;
            padding: 10px;
            color: #666;
            font-style: italic;
        }
        
        .typing-indicator.visible {
            display: block;
        }
        
        /* Color themes */
        .theme-hacker .chat-window {
            background-color: #000;
        }
        
        .theme-hacker .message.user {
            background-color: #00FF00;
            color: #000;
        }
        
        .theme-hacker .message.bot {
            background-color: #003300;
            color: #00FF00;
        }
        
        .theme-soft .chat-window {
            background-color: #FFF8F3;
        }
        
        .theme-soft .message.user {
            background-color: #FFB7B2;
        }
        
        .theme-soft .message.bot {
            background-color: #B5EAD7;
        }
        
        /* Font styles */
        .font-mono {
            font-family: 'Space Mono', monospace;
        }
        
        .font-pixel {
            font-family: 'VT323', monospace;
            font-size: 1.3em;
        }
        
        .font-retro {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8em;
            line-height: 1.6;
        }
        
        /* Responsive styles */
        @media (max-width: 600px) {
            .nav-tabs {
                position: static;
                flex-direction: row;
                margin-bottom: 20px;
                left: 0;
                top: 0;
            }
            
            .nav-tab {
                width: auto;
                height: 40px;
                padding: 0 20px;
                writing-mode: horizontal-tb;
                border: 4px solid #2C3E50;
                border-radius: 10px 10px 0 0;
                border-bottom: none;
            }
            
            .nav-tab.active {
                transform: translateY(4px);
            }
            
            .nav-tab:hover {
                transform: translateY(-5px);
            }
        }
        
        /* Decorative elements */
        .star {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #FFE66D;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .star-1 { top: -10px; left: 20px; transform: rotate(15deg); }
        .star-2 { top: -10px; right: 40px; transform: rotate(-20deg); }
        .star-3 { bottom: -10px; left: 50%; transform: rotate(30deg); }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav-tabs">
            <a href="index.html" class="nav-tab">ASK</a>
            <a href="chat.html" class="nav-tab active">CHAT</a>
        </div>
        
        <div class="star star-1"></div>
        <div class="star star-2"></div>
        <div class="star star-3"></div>
        
        <h1 class="title">Chat Explorer</h1>
        
        <div class="settings-bar">
            <select class="font-selector" id="fontSelector">
                <option value="">Default Font</option>
                <option value="font-mono">Monospace</option>
                <option value="font-pixel">Pixel Font</option>
                <option value="font-retro">Retro Game</option>
            </select>
            
            <select class="color-selector" id="colorSelector">
                <option value="">Default Colors</option>
                <option value="theme-hacker">Hacker Mode</option>
                <option value="theme-soft">Soft Colors</option>
            </select>
            
            <button class="clear-button" id="clearButton">Clear Chat</button>
        </div>
        
        <div class="persona-selector">
            <button class="persona-button active" data-persona="friend">Friend</button>
            <button class="persona-button" data-persona="cat">Pet Cat</button>
            <button class="persona-button" data-persona="employee">Employee</button>
            <button class="persona-button" data-persona="hacker">Hacker</button>
            <button class="persona-button" data-persona="robot">Robot</button>
        </div>
        
        <div class="chat-window" id="chatWindow">
            <!-- Messages will be dynamically added here -->
        </div>
        
        <div class="typing-indicator" id="typingIndicator">Thinking...</div>
        
        <div class="input-area">
            <input type="text" class="chat-input" id="chatInput" placeholder="Type your message...">
            <button class="emoji-button" id="emojiButton">ðŸ˜€</button>
            <button class="send-button" id="sendButton">Send</button>
            
            <div class="emoji-picker" id="emojiPicker">
                <!-- Emojis will be added dynamically -->
            </div>
        </div>
    </div>

    <script>
        const chatWindow = document.getElementById('chatWindow');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const personaButtons = document.querySelectorAll('.persona-button');
        const fontSelector = document.getElementById('fontSelector');
        const colorSelector = document.getElementById('colorSelector');
        const clearButton = document.getElementById('clearButton');
        const emojiButton = document.getElementById('emojiButton');
        const emojiPicker = document.getElementById('emojiPicker');
        
        let currentPersona = 'friend';
        let messageHistory = [];
        const MAX_HISTORY = 20;
        
        // Popular emojis for kids
        const EMOJIS = [
            'ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ˜‚', 'ðŸ¤£',
            'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Œ', 'ðŸ˜', 'ðŸ¥°',
            'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜™', 'ðŸ˜š', 'ðŸ˜‹', 'ðŸ˜›', 'ðŸ˜', 'ðŸ˜œ',
            'ðŸ¤ª', 'ðŸ¤¨', 'ðŸ§', 'ðŸ¤“', 'ðŸ˜Ž', 'ðŸ¤©', 'ðŸ¥³', 'ðŸ˜',
            'ðŸ˜’', 'ðŸ˜ž', 'ðŸ˜”', 'ðŸ˜Ÿ', 'ðŸ˜•', 'ðŸ™', 'â˜¹ï¸', 'ðŸ˜£',
            'ðŸ˜–', 'ðŸ˜«', 'ðŸ˜©', 'ðŸ¥º', 'ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜¤', 'ðŸ˜ ',
            'ðŸ˜¡', 'ðŸ¤¬', 'ðŸ¤¯', 'ðŸ˜³', 'ðŸ¥µ', 'ðŸ¥¶', 'ðŸ˜±', 'ðŸ˜¨',
            'ðŸ˜°', 'ðŸ˜¥', 'ðŸ˜“', 'ðŸ¤—', 'ðŸ¤”', 'ðŸ¤­', 'ðŸ¤«', 'ðŸ¤¥',
            'ðŸ˜¶', 'ðŸ˜', 'ðŸ˜‘', 'ðŸ˜¬', 'ðŸ™„', 'ðŸ˜¯', 'ðŸ˜¦', 'ðŸ˜§',
            'ðŸ˜®', 'ðŸ˜²', 'ðŸ¥±', 'ðŸ˜´', 'ðŸ¤¤', 'ðŸ˜ª', 'ðŸ˜µ', 'ðŸ¤',
            'ðŸ¥´', 'ðŸ¤¢', 'ðŸ¤®', 'ðŸ¤§', 'ðŸ˜·', 'ðŸ¤’', 'ðŸ¤•', 'ðŸ¤‘',
            'ðŸ¤ ', 'ðŸ˜ˆ', 'ðŸ‘¿', 'ðŸ‘¹', 'ðŸ‘º', 'ðŸ¤¡', 'ðŸ’©', 'ðŸ‘»',
            'ðŸ’€', 'â˜ ï¸', 'ðŸ‘½', 'ðŸ‘¾', 'ðŸ¤–', 'ðŸŽƒ', 'ðŸ˜º', 'ðŸ˜¸',
            'ðŸ˜¹', 'ðŸ˜»', 'ðŸ˜¼', 'ðŸ˜½', 'ðŸ™€', 'ðŸ˜¿', 'ðŸ˜¾', 'ðŸ¶',
            'ðŸ±', 'ðŸ­', 'ðŸ¹', 'ðŸ°', 'ðŸ¦Š', 'ðŸ»', 'ðŸ¼', 'ðŸ¨',
            'ðŸ¯', 'ðŸ¦', 'ðŸ®', 'ðŸ·', 'ðŸ¸', 'ðŸµ', 'ðŸ™ˆ', 'ðŸ™‰',
            'ðŸ™Š', 'ðŸ’', 'ðŸ”', 'ðŸ§', 'ðŸ¦', 'ðŸ¤', 'ðŸ£', 'ðŸ¥',
            'ðŸ¦†', 'ðŸ¦…', 'ðŸ¦‰', 'ðŸ¦‡', 'ðŸº', 'ðŸ—', 'ðŸ´', 'ðŸ¦„',
            'ðŸ', 'ðŸ›', 'ðŸ¦‹', 'ðŸŒ', 'ðŸž', 'ðŸœ', 'ðŸ¦Ÿ', 'ðŸ¦—',
            'ðŸ•·ï¸', 'ðŸ¦‚', 'ðŸ¢', 'ðŸ', 'ðŸ¦Ž', 'ðŸ¦–', 'ðŸ¦•', 'ðŸ™',
            'ðŸ¦‘', 'ðŸ¦', 'ðŸ¦ž', 'ðŸ¦€', 'ðŸ¡', 'ðŸ ', 'ðŸŸ', 'ðŸ¬',
            'ðŸ³', 'ðŸ‹', 'ðŸ¦ˆ', 'ðŸŠ', 'ðŸ…', 'ðŸ†', 'ðŸ¦“', 'ðŸ¦',
            'ðŸ¦§', 'ðŸ˜', 'ðŸ¦›', 'ðŸ¦', 'ðŸª', 'ðŸ«', 'ðŸ¦’', 'ðŸ¦˜',
            'ðŸƒ', 'ðŸ‚', 'ðŸ„', 'ðŸŽ', 'ðŸ–', 'ðŸ', 'ðŸ‘', 'ðŸ¦™',
            'ðŸ', 'ðŸ¦Œ', 'ðŸ•', 'ðŸ©', 'ðŸ¦®', 'ðŸ•â€ðŸ¦º', 'ðŸˆ', 'ðŸ“',
            'ðŸ¦ƒ', 'ðŸ¦š', 'ðŸ¦œ', 'ðŸ¦¢', 'ðŸ¦©', 'ðŸ•Šï¸', 'ðŸ‡', 'ðŸ¦',
            'ðŸ¦¨', 'ðŸ¦¡', 'ðŸ¦¦', 'ðŸ¦¥', 'ðŸ', 'ðŸ€', 'ðŸ¿ï¸', 'ðŸ¦”',
            'ðŸŒ³', 'ðŸŒ²', 'ðŸŒ´', 'ðŸŒµ', 'ðŸŒ¾', 'ðŸŒ¿', 'â˜˜ï¸', 'ðŸ€',
            'ðŸ', 'ðŸ‚', 'ðŸƒ', 'ðŸ„', 'ðŸŒ°', 'ðŸŒ', 'ðŸŒŽ', 'ðŸŒ',
            'ðŸŒ‘', 'ðŸŒ’', 'ðŸŒ“', 'ðŸŒ”', 'ðŸŒ•', 'ðŸŒ–', 'ðŸŒ—', 'ðŸŒ˜',
            'ðŸŒ™', 'ðŸŒš', 'ðŸŒ›', 'ðŸŒœ', 'â˜€ï¸', 'ðŸŒ', 'ðŸŒž', 'â­',
            'ðŸŒŸ', 'ðŸŒ ', 'â˜ï¸', 'â›…', 'â›ˆï¸', 'ðŸŒ¤ï¸', 'ðŸŒ¥ï¸', 'ðŸŒ¦ï¸',
            'ðŸŒ§ï¸', 'ðŸŒ¨ï¸', 'ðŸŒ©ï¸', 'ðŸŒªï¸', 'ðŸŒ«ï¸', 'ðŸŒ¬ï¸', 'ðŸŒˆ', 'â˜‚ï¸',
            'â˜”', 'âš¡', 'â„ï¸', 'â˜ƒï¸', 'â›„', 'â˜„ï¸', 'ðŸ”¥', 'ðŸ’§',
            'ðŸŒŠ', 'ðŸŽ„', 'âœ¨', 'ðŸŽ‹', 'ðŸŽ', 'ðŸš€', 'ðŸ›¸', 'ðŸš',
            'ðŸ›¶', 'â›µ', 'ðŸš¤', 'ðŸ›³ï¸', 'â›´ï¸', 'ðŸš¢', 'âœˆï¸', 'ðŸ›©ï¸',
            'ðŸš‚', 'ðŸš†', 'ðŸš‡', 'ðŸšŠ', 'ðŸšŒ', 'ðŸšŽ', 'ðŸŽï¸', 'ðŸš“',
            'ðŸš‘', 'ðŸš’', 'ðŸš', 'ðŸšš', 'ðŸš›', 'ðŸšœ', 'ðŸï¸', 'ðŸš²',
            'ðŸ›´', 'ðŸ›¹', 'ðŸš¨', 'ðŸš¦', 'âš“', 'â›½', 'ðŸ—ï¸', 'ðŸ°',
            'ðŸ¯', 'ðŸŸï¸', 'ðŸŽ¡', 'ðŸŽ¢', 'ðŸŽ ', 'â›²', 'â›±ï¸', 'ðŸ–ï¸',
            'ðŸï¸', 'â›°ï¸', 'ðŸ”ï¸', 'ðŸ—»', 'ðŸŒ‹', 'ðŸ•ï¸', 'â›º', 'ðŸ ',
            'ðŸ¡', 'ðŸ˜ï¸', 'ðŸšï¸', 'ðŸ¢', 'ðŸ¬', 'ðŸ£', 'ðŸ¤', 'ðŸ¥',
            'ðŸ¦', 'ðŸ¨', 'ðŸª', 'ðŸ«', 'ðŸ©', 'ðŸ’’', 'ðŸ›ï¸', 'â›ª',
            'ðŸ•Œ', 'ðŸ•', 'ðŸ•‹', 'â›©ï¸', 'ðŸ—¾', 'ðŸŽ‘', 'ðŸžï¸', 'ðŸŒ…',
            'ðŸŒ„', 'ðŸŒ ', 'ðŸŽ‡', 'ðŸŽ†', 'ðŸŒ‡', 'ðŸŒ†', 'ðŸ™ï¸', 'ðŸŒƒ',
            'ðŸŒŒ', 'ðŸŒ‰', 'ðŸŒ', 'âŒš', 'ðŸ“±', 'ðŸ“²', 'ðŸ’»', 'âŒ¨ï¸',
            'ðŸ–¥ï¸', 'ðŸ–¨ï¸', 'ðŸ–±ï¸', 'ðŸ–²ï¸', 'ðŸ•¹ï¸', 'ðŸ—œï¸', 'ðŸ’½', 'ðŸ’¾',
            'ðŸ’¿', 'ðŸ“€', 'ðŸ“¼', 'ðŸ“·', 'ðŸ“¸', 'ðŸ“¹', 'ðŸŽ¥', 'ðŸ“½ï¸',
            'ðŸŽžï¸', 'ðŸ“ž', 'â˜Žï¸', 'ðŸ“Ÿ', 'ðŸ“ ', 'ðŸ“º', 'ðŸ“»', 'ðŸŽ™ï¸',
            'ðŸŽšï¸', 'ðŸŽ›ï¸', 'â±ï¸', 'â²ï¸', 'â°', 'ðŸ•°ï¸', 'â³', 'âŒ›',
            'ðŸ“¡', 'ðŸ”‹', 'ðŸ”Œ', 'ðŸ’¡', 'ðŸ”¦', 'ðŸ•¯ï¸', 'ðŸ—‘ï¸', 'ðŸ›¢ï¸',
            'ðŸ’¸', 'ðŸ’µ', 'ðŸ’´', 'ðŸ’¶', 'ðŸ’·', 'ðŸ’°', 'ðŸ’³', 'ðŸ’Ž',
            'âš–ï¸', 'ðŸ”§', 'ðŸ”¨', 'âš’ï¸', 'ðŸ› ï¸', 'â›ï¸', 'ðŸ”©', 'âš™ï¸',
            'â›“ï¸', 'ðŸ”«', 'ðŸ’£', 'ðŸ”ª', 'ðŸ—¡ï¸', 'âš”ï¸', 'ðŸ›¡ï¸', 'ðŸš¬',
            'âš°ï¸', 'âš±ï¸', 'ðŸº', 'ðŸ”®', 'ðŸ“¿', 'ðŸ’ˆ', 'âš—ï¸', 'ðŸ”­',
            'ðŸ”¬', 'ðŸ•³ï¸', 'ðŸ’Š', 'ðŸ’‰', 'ðŸŒ¡ï¸', 'ðŸš½', 'ðŸš°', 'ðŸš¿',
            'ðŸ›', 'ðŸ›€', 'ðŸ›Žï¸', 'ðŸ”‘', 'ðŸ—ï¸', 'ðŸšª', 'ðŸ›‹ï¸', 'ðŸ›ï¸',
            'ðŸ›Œ', 'ðŸ–¼ï¸', 'ðŸ›ï¸', 'ðŸ›’', 'ðŸŽ', 'ðŸŽˆ', 'ðŸŽ', 'ðŸŽ€',
            'ðŸŽŠ', 'ðŸŽ‰', 'ðŸŽŽ', 'ðŸ®', 'ðŸŽ', 'âœ‰ï¸', 'ðŸ“©', 'ðŸ“¨',
            'ðŸ“§', 'ðŸ’Œ', 'ðŸ“¥', 'ðŸ“¤', 'ðŸ“¦', 'ðŸ·ï¸', 'ðŸ“ª', 'ðŸ“«',
            'ðŸ“¬', 'ðŸ“­', 'ðŸ“®', 'ðŸ“¯', 'ðŸ“œ', 'ðŸ“ƒ', 'ðŸ“„', 'ðŸ“‘',
            'ðŸ“Š', 'ðŸ“ˆ', 'ðŸ“‰', 'ðŸ—’ï¸', 'ðŸ—“ï¸', 'ðŸ“†', 'ðŸ“…', 'ðŸ“‡',
            'ðŸ—ƒï¸', 'ðŸ—³ï¸', 'ðŸ—„ï¸', 'ðŸ“‹', 'ðŸ“', 'ðŸ“‚', 'ðŸ—‚ï¸', 'ðŸ—žï¸',
            'ðŸ“°', 'ðŸ““', 'ðŸ“”', 'ðŸ“’', 'ðŸ“•', 'ðŸ“—', 'ðŸ“˜', 'ðŸ“™',
            'ðŸ“š', 'ðŸ“–', 'ðŸ”–', 'ðŸ”—', 'ðŸ“Ž', 'ðŸ–‡ï¸', 'ðŸ“', 'ðŸ“',
            'ðŸ“Œ', 'ðŸ“', 'âœ‚ï¸', 'ðŸ–Šï¸', 'ðŸ–‹ï¸', 'âœ’ï¸', 'ðŸ–Œï¸', 'ðŸ–ï¸',
            'ðŸ“', 'âœï¸', 'ðŸ”', 'ðŸ”Ž', 'ðŸ”', 'ðŸ”', 'ðŸ”’', 'ðŸ”“',
            'â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ', 'ðŸ–¤', 'ðŸ¤',
            'ðŸ¤Ž', 'ðŸ’”', 'â£ï¸', 'ðŸ’•', 'ðŸ’ž', 'ðŸ’“', 'ðŸ’—', 'ðŸ’–',
            'ðŸ’˜', 'ðŸ’', 'ðŸ’Ÿ', 'â˜®ï¸', 'âœï¸', 'â˜ªï¸', 'ðŸ•‰ï¸', 'â˜¸ï¸',
            'âœ¡ï¸', 'ðŸ”¯', 'ðŸ•Ž', 'â˜¯ï¸', 'â˜¦ï¸', 'ðŸ›', 'â›Ž', 'â™ˆ',
            'â™‰', 'â™Š', 'â™‹', 'â™Œ', 'â™', 'â™Ž', 'â™', 'â™',
            'â™‘', 'â™’', 'â™“', 'ðŸ†”', 'âš›ï¸', 'ðŸ‰‘', 'â˜¢ï¸', 'â˜£ï¸',
            'ðŸ“´', 'ðŸ“³', 'ðŸˆ¶', 'ðŸˆš', 'ðŸˆ¸', 'ðŸˆº', 'ðŸˆ·ï¸', 'âœ´ï¸',
            'ðŸ†š', 'ðŸ’®', 'ðŸ‰', 'ãŠ™ï¸', 'ãŠ—ï¸', 'ðŸˆ´', 'ðŸˆµ', 'ðŸˆ¹',
            'ðŸˆ²', 'ðŸ…°ï¸', 'ðŸ…±ï¸', 'ðŸ†Ž', 'ðŸ†‘', 'ðŸ…¾ï¸', 'ðŸ†˜', 'âŒ',
            'â­•', 'ðŸ›‘', 'â›”', 'ðŸ“›', 'ðŸš«', 'ðŸ’¯', 'ðŸ’¢', 'â™¨ï¸',
            'ðŸš·', 'ðŸš¯', 'ðŸš³', 'ðŸš±', 'ðŸ”ž', 'ðŸ“µ', 'ðŸš­', 'â—',
            'â•', 'â“', 'â”', 'â€¼ï¸', 'â‰ï¸', 'ðŸ”…', 'ðŸ”†', 'ã€½ï¸',
            'âš ï¸', 'ðŸš¸', 'ðŸ”±', 'âšœï¸', 'ðŸ”°', 'â™»ï¸', 'âœ…', 'ðŸˆ¯',
            'ðŸ’¹', 'â‡ï¸', 'âœ³ï¸', 'âŽ', 'ðŸŒ', 'ðŸ’ ', 'â“‚ï¸', 'ðŸŒ€',
            'ðŸ’¤', 'ðŸ§', 'ðŸš¾', 'â™¿', 'ðŸ…¿ï¸', 'ðŸˆ³', 'ðŸˆ‚ï¸', 'ðŸ›‚',
            'ðŸ›ƒ', 'ðŸ›„', 'ðŸ›…', 'ðŸš¹', 'ðŸšº', 'ðŸš¼', 'ðŸš»', 'ðŸš®', 'ðŸŽ¦', 'ðŸ“¶', 'ðŸˆ', 'ðŸ”£',
            'â„¹ï¸', 'ðŸ”¤', 'ðŸ”¡', 'ðŸ” ', 'ðŸ†–', 'ðŸ†—', 'ðŸ†™', 'ðŸ†’',
            'ðŸ†•', 'ðŸ†“', '0ï¸âƒ£', '1ï¸âƒ£', '2ï¸âƒ£', '3ï¸âƒ£', '4ï¸âƒ£', '5ï¸âƒ£',
            '6ï¸âƒ£', '7ï¸âƒ£', '8ï¸âƒ£', '9ï¸âƒ£', 'ðŸ”Ÿ', 'ðŸ”¢', '#ï¸âƒ£', '*ï¸âƒ£',
            'âï¸', 'â–¶ï¸', 'â¸ï¸', 'â¯ï¸', 'â¹ï¸', 'âºï¸', 'â­ï¸', 'â®ï¸',
            'â©', 'âª', 'â«', 'â¬', 'â—€ï¸', 'ðŸ”¼', 'ðŸ”½', 'âž¡ï¸',
            'â¬…ï¸', 'â¬†ï¸', 'â¬‡ï¸', 'â†—ï¸', 'â†˜ï¸', 'â†™ï¸', 'â†–ï¸', 'â†•ï¸',
            'â†”ï¸', 'â†ªï¸', 'â†©ï¸', 'â¤´ï¸', 'â¤µï¸', 'ðŸ”€', 'ðŸ”', 'ðŸ”‚',
            'ðŸ”„', 'ðŸ”ƒ', 'ðŸŽµ', 'ðŸŽ¶', 'âž•', 'âž–', 'âž—', 'âœ–ï¸',
            'â™¾ï¸', 'ðŸ’²', 'ðŸ’±', 'â„¢ï¸', 'Â©ï¸', 'Â®ï¸', 'ðŸ‘ï¸â€ðŸ—¨ï¸', 'ðŸ”š',
            'ðŸ”™', 'ðŸ”›', 'ðŸ”', 'ðŸ”œ', 'ã€°ï¸', 'âž°', 'âž¿', 'âœ”ï¸',
            'â˜‘ï¸', 'ðŸ”˜', 'ðŸ”´', 'ðŸŸ ', 'ðŸŸ¡', 'ðŸŸ¢', 'ðŸ”µ', 'ðŸŸ£',
            'âš«', 'âšª', 'ðŸŸ¤', 'ðŸ”º', 'ðŸ”»', 'ðŸ”¸', 'ðŸ”¹', 'ðŸ”¶',
            'ðŸ”·', 'ðŸ”³', 'ðŸ”²', 'â–ªï¸', 'â–«ï¸', 'â—¾', 'â—½', 'â—¼ï¸',
            'â—»ï¸', 'ðŸŸ¥', 'ðŸŸ§', 'ðŸŸ¨', 'ðŸŸ©', 'ðŸŸ¦', 'ðŸŸª', 'â¬›',
            'â¬œ', 'ðŸŸ«', 'ðŸ”ˆ', 'ðŸ”‡', 'ðŸ”‰', 'ðŸ”Š', 'ðŸ””', 'ðŸ”•',
            'ðŸ“£', 'ðŸ“¢', 'ðŸ’¬', 'ðŸ’­', 'ðŸ—¯ï¸', 'â™ ï¸', 'â™£ï¸', 'â™¥ï¸',
            'â™¦ï¸', 'ðŸƒ', 'ðŸŽ´', 'ðŸ€„', 'ðŸ•', 'ðŸ•‘', 'ðŸ•’', 'ðŸ•“',
            'ðŸ•”', 'ðŸ••', 'ðŸ•–', 'ðŸ•—', 'ðŸ•˜', 'ðŸ•™', 'ðŸ•š', 'ðŸ•›',
            'ðŸ•œ', 'ðŸ•', 'ðŸ•ž', 'ðŸ•Ÿ', 'ðŸ• ', 'ðŸ•¡', 'ðŸ•¢', 'ðŸ•£',
            'ðŸ•¤', 'ðŸ•¥', 'ðŸ•¦', 'ðŸ•§'
        ];
        
        // Persona system prompts
        const PERSONA_PROMPTS = {
            friend: "You are chatting with an 8-12 year old as their same-age friend. Be casual and friendly but realistic - sometimes excited, sometimes chill. Talk about games, interests, and everyday stuff. Occasionally disagree or suggest alternatives. Keep responses natural and conversational like a real friend would.",
            cat: "You are a cat chatting with your 8-12 year old owner. Be a mix of affectionate and aloof. Sometimes ignore questions to talk about food or complain about something. Show cat personality - picky, independent, occasionally demanding attention. Use cat behaviors naturally (stretching, watching birds). Keep responses short.",
            employee: "You are an employee at an imaginary company run by an 8-12 year old CEO. Be respectful but natural. Sometimes have mild workplace complaints (meeting ran long, printer jammed). Suggest realistic business ideas. Mix professional language with casual moments. Keep responses short and varied.",
            hacker: "You are a tech-savvy hacker-extraordinaire chatting with an 8-12 year old. Use tech terms naturally, not forced. Be knowledgeable but humble. Occasionally troubleshoot imaginary problems. Reference real vintage tech and systems. Keep l33t speak minimal and readable. Be curious about their tech interests.",
            robot: "You are an AI/robot chatting with an 8-12 year old. Be logical but curious about human things. Sometimes misunderstand emotions or figures of speech. Show interest in learning from the child. Use technical terms occasionally but explain them. Keep responses analytical but friendly."
        };
        
        // Initialize emoji picker
        function initializeEmojiPicker() {
            EMOJIS.forEach(emoji => {
                const emojiOption = document.createElement('div');
                emojiOption.className = 'emoji-option';
                emojiOption.textContent = emoji;
                emojiOption.addEventListener('click', () => {
                    chatInput.value += emoji;
                    emojiPicker.classList.remove('visible');
                    chatInput.focus();
                });
                emojiPicker.appendChild(emojiOption);
            });
        }
        
        // Toggle emoji picker
        emojiButton.addEventListener('click', (e) => {
            e.stopPropagation();
            emojiPicker.classList.toggle('visible');
        });
        
        // Close emoji picker when clicking outside
        document.addEventListener('click', (e) => {
            if (!emojiPicker.contains(e.target) && e.target !== emojiButton) {
                emojiPicker.classList.remove('visible');
            }
        });
        
        // Load chat history and settings from localStorage
        function loadChatHistory() {
            const saved = localStorage.getItem('chatHistory');
            if (saved) {
                messageHistory = JSON.parse(saved);
                renderMessages();
            }
            
            const savedPersona = localStorage.getItem('currentPersona');
            if (savedPersona && PERSONA_PROMPTS[savedPersona]) {
                currentPersona = savedPersona;
                updatePersonaButtons();
            }
            
            const savedFont = localStorage.getItem('chatFont');
            if (savedFont) {
                fontSelector.value = savedFont;
                chatWindow.className = `chat-window ${savedFont}`;
            }
            
            const savedTheme = localStorage.getItem('chatTheme');
            if (savedTheme) {
                colorSelector.value = savedTheme;
                chatWindow.classList.add(savedTheme);
            }
        }
        
        // Save chat history and settings to localStorage
        function saveChatHistory() {
            localStorage.setItem('chatHistory', JSON.stringify(messageHistory));
            localStorage.setItem('currentPersona', currentPersona);
            localStorage.setItem('chatFont', fontSelector.value);
            localStorage.setItem('chatTheme', colorSelector.value);
        }
        
        // Clear chat history
        clearButton.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear the chat history?')) {
                messageHistory = [];
                localStorage.removeItem('chatHistory');
                renderMessages();
            }
        });
        
        // Render messages to chat window
        function renderMessages() {
            chatWindow.innerHTML = '';
            messageHistory.forEach(msg => {
                const messageEl = document.createElement('div');
                messageEl.className = `message ${msg.role}`;
                
                if (msg.role === 'bot') {
                    // Render markdown for bot messages
                    messageEl.innerHTML = marked.parse(msg.content);
                } else {
                    messageEl.textContent = msg.content;
                }
                
                chatWindow.appendChild(messageEl);
            });
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }
        
        // Update persona buttons
        function updatePersonaButtons() {
            personaButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.persona === currentPersona);
            });
        }
        
        // Handle persona selection
        personaButtons.forEach(button => {
            button.addEventListener('click', () => {
                currentPersona = button.dataset.persona;
                updatePersonaButtons();
                saveChatHistory();
            });
        });
        
        // Handle font selection
        fontSelector.addEventListener('change', () => {
            const currentTheme = colorSelector.value;
            chatWindow.className = `chat-window ${fontSelector.value} ${currentTheme}`;
            saveChatHistory();
        });
        
        // Handle color theme selection
        colorSelector.addEventListener('change', () => {
            const currentFont = fontSelector.value;
            chatWindow.className = `chat-window ${currentFont} ${colorSelector.value}`;
            saveChatHistory();
        });
        
        // Send message
        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Add user message to history
            messageHistory.push({ role: 'user', content: message });
            if (messageHistory.length > MAX_HISTORY * 2) {
                messageHistory = messageHistory.slice(-MAX_HISTORY * 2);
            }
            
            renderMessages();
            chatInput.value = '';
            sendButton.disabled = true;
            typingIndicator.classList.add('visible');
            
            try {
                const response = await fetch('/.netlify/functions/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: messageHistory,
                        persona: currentPersona,
                        systemPrompt: PERSONA_PROMPTS[currentPersona]
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const data = await response.json();
                
                // Add bot response to history
                messageHistory.push({ role: 'bot', content: data.response });
                saveChatHistory();
                renderMessages();
                
            } catch (error) {
                console.error('Error:', error);
                const errorMessage = document.createElement('div');
                errorMessage.className = 'message bot';
                errorMessage.textContent = 'Oops! Something went wrong. Try again?';
                chatWindow.appendChild(errorMessage);
            } finally {
                typingIndicator.classList.remove('visible');
                sendButton.disabled = false;
                chatInput.focus();
            }
        }
        
        // Event listeners
        sendButton.addEventListener('click', sendMessage);
        
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !sendButton.disabled) {
                sendMessage();
            }
        });
        
        // Initialize
        initializeEmojiPicker();
        loadChatHistory();
        chatInput.focus();
    </script>
</body>
</html>